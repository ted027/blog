---
title: "8/23に起きたAWSのシステムトラブルのこと"
date: 2019-08-24T14:41:46+09:00
draft: true
comments: true
toc: true
categories: ["AWS"]
tags: ["システム障害", "サーバーレス", "AZ"]
---

<!--more-->

---

{{< ad/a8/techstars >}}

---

2019年8月23日、AWSで大規模なシステム障害が起きました。これに伴い複数のゲームやWebサイト、サービス等が一時使えなくなり、結構大きな問題になったようです。

今回はこの問題について、むかつくけど何が起きたのかわからん…という人もなるべくわかるように、そこそこ丁寧に書いてみます。

### 超基本知識

AWS (Amazon Web Service)とは、アマゾン社が提供するクラウドコンピューティングサービスです。

普通、ゲームなりWebサイトなりを提供するには、自前でサーバーを用意し、この中でサービスを実行、お客さんにはこのサーバーにアクセスしてもらう必要があります。

しかし、サーバーを管理するのはとにかく手間もお金もかかります。そこで、AmazonやGoogleのような会社が土地と計算資源を用意し、細心の注意を持って管理、利用者は利用する計算資源の分だけ料金を負担する「クラウドコンピューティング」というのが流行…したのが一昔前で、今やすっかり社会に定着しています。

今やただのサーバーやDB、ストレージ等に留まらず、機械学習やらk8sやらブロックチェーンやら、利用者が色々なものを利用しやすいように、多種多様なサービスが展開されています。

---

### 基本知識

AWSは様々なリージョン（地域）に拠点を持っています。利用者はこのリージョンを決め、その地域のサーバを利用します。

更にAWSでは、このリージョン内に、複数のデータセンター（サーバが置いてあるビル）を持っています。なので、特定のビルで火災や異常が発生した場合でも、他のビルでサーバが生きていれば、サービス自体は提供できるということになります。

で、もう一つ、AZ（アベイラビリティーゾーン）という概念があります。これはデータセンターとイコールではないのですが、何となく近い概念だと思っていただければいいかと思います。詳しくは以下のリンクに書いてあります。

    - https://qiita.com/saitotak/items/f56234d0506b47ddbcfe

---

### 何が起きたのか

どうも東京リージョンのどこかのデータセンターで冷却装置が故障して、サーバーが高温になり、深刻なダメージを受けて落ちたようです。これによって特定のAZが一時的に死んでしまい、そこを利用しているサービスが軒並み利用できなくなった、ということですね。

サーバートラブルとしてはごくごく一般的なものですが、数多くの開発に用いられているAWSで発生したことにより、影響範囲がとても大きくなりました。

---

### どうすればよかったのか① マルチAZ対応

今回は特定のAZが落ちてしまったということで、「マルチAZ対応」を行っていれば障害は防げたという声があります。

マルチAZというのは、複数のAZでサービスを展開することで、特定のAZで問題が生じてもサービス自体は止めないようにする障害対策です。確かにこうすれば、一つのAZで障害が起きても問題無さそうに見えます。

ただ、これだけで必ずしも今回の障害を防げたかは分かりません。例えば、複数のAZに処理を冗長化するELB（Elsatic Load Balancer）のサービス自体が障害の起きたAZで提供されていた場合、サービスはあえなく止まってしまいます。

---

### どうすればよかったのか② サーバーレス

「サーバーレス」と言っても本当にサーバーが無くなるわけではないですが、提供元がサーバー管理までしてくれるので管理が不要となり、あたかもサーバーが無いかのように開発できます。

今回主に障害が起きたのはEC2(Elastic Compute Cloud)というサービスで、アマゾンの保有する計算資源(サーバー)を時間あたりの料金で利用できるサービスです。「アマゾンが持っているサーバーを、自分で管理して自分で使う」ということです。

なので、どこのAZのサーバーを利用するか、複数利用するか、どれくらい領域を確保するかは利用者任せです。障害対策も自分たちで行わないといけません。

一方サーバーレスでは「アマゾンが持っているサーバーをアマゾンが管理し、自分が使う」イメージです。

サーバーレスにしたら障害のことを考えなくていいとか、AZ障害の影響を受けないとか、そういうわけではありません。しかし、利用者が特別な何かを行わなくても、障害が起きたAZを避ける、必ず複数のAZで実行する、といった障害対策が行われています。

---

### おわり

サーバーレスしゅごい

アマゾン側の問題なのは間違いないんですが、全く想像もつかない障害ではなく、こういうこともあるよね…っていう障害です。

こういうことがあると「やはりクラウドサービスなんか信頼ならん！オンプレだ！」みたいな人もいるのでしょうか？

AWS使っててフェイルオーバーできないのに、オンプレでできるとも思えないのですが。。

---

### 参考

- [AWSの障害は冷却装置の故障が原因--サービスはほぼ復旧](https://japan.zdnet.com/article/35141698/)
- [AWSのAZ障害で影響を受けた・受けなかったの設計の違い。サーバレス最高！](http://gs2.hatenablog.com/entry/2019/08/23/232534)

---

{{< ad/con/wide/aws >}}

---

{{< ad/a8/techacademy1 >}}

---
