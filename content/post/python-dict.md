---
title: "Pythonで階層dictをコピーして使う"
date: 2019-05-15T22:06:08+09:00
draft: false
comments: true
categories: ["Python"]
tags: ["dict", "階層"]
---

Pythonでdictをコピーして使うときの諸々。

<!--more-->

---

{{< ad/a8/geekjob >}}

---

{{< ad/con/wide/python_dokugaku >}}

---

### dictは参照渡し

同じ初期値のdictを複数作り、それぞれ別で使いたいことがある。

その際、普通にdictを渡すと、参照先が同じになってしまう。

```py
>>> ichiro = {'打率': '', '本塁打': ''}
>>> saburo = ichiro
>>> ichiro['打率'] = '.400'
>>> ichiro
{'打率': '.400', '本塁打': ''}
>>> saburo
{'打率': '.400', '本塁打': ''}
```

---

### copyを使う

`copy`を使って複製すれば、新たなdictを作る。

```py
>>> ichiro = {'打率': '', '本塁打': ''}
>>> saburo = ichiro.copy()
>>> ichiro['打率'] = '.400'
>>> ichiro
{'打率': '.400', '本塁打': ''}
>>> saburo
{'打率': '', '本塁打': ''}
```

ただし、dictが階層構造の場合、子dictの参照先が同じになってしまう。

```py
>>> ichiro = {'打率': '', '本塁打': '', '対右': {'打率': '', '本塁打': ''}}
>>> saburo = ichiro.copy()
>>> ichiro['打率'] = '.400'
>>> ichiro['対右']['打率'] = '.450'
>>> ichiro
{'打率': '.400', '本塁打': '', '対右': {'打率': '.450', '本塁打': ''}}
>>> saburo
{'打率': '', '本塁打': '', '対右': {'打率': '.450', '本塁打': ''}}
```

---

### deepcopyを使う

この場合、`copy.deepcopy`を使うことで、子dictまで複製することができる。

```py
>>> import copy
>>> ichiro = {'打率': '', '本塁打': '', '対右': {'打率': '', '本塁打': ''}}
>>> saburo = copy.deepcopy(ichiro)
>>> ichiro['打率'] = '.400'
>>> ichiro['対右']['打率'] = '.450'
>>> ichiro
{'打率': '.400', '本塁打': '', '対右': {'打率': '.450', '本塁打': ''}}
>>> saburo
{'打率': '', '本塁打': '', '対右': {'打率': '', '本塁打': ''}}
```

---

### 内包表記で作る

内包表記で複数作っておいて渡す、というのもある。たくさん作るならこちらのほうが便利。

```py
>>> list = [{'打率': '', '本塁打': '', '対右': {'打率': '', '本塁打': ''}} for _ in range(2)]
>>> ichiro = list[0]
>>> saburo = list[1]
>>> ichiro['打率'] = '.400'
>>> ichiro['対右']['打率'] = '.450'
>>> ichiro
{'打率': '.400', '本塁打': '', '対右': {'打率': '.450', '本塁打': ''}}
>>> saburo
{'打率': '', '本塁打': '', '対右': {'打率': '', '本塁打': ''}}
```

このケースならdict内包表記で作っておくのが一番楽そう。

```py
>>> dic = {player: {'打率': '', '本塁打': '', '対右': {'打率': '', '本塁打': ''}} for player in ['ichiro', 'saburo']}
>>> dic['ichiro']['打率'] = '.400'
>>> dic['ichiro']['対右']['打率'] = '.450'
>>> dic
{'ichiro': {'打率': '.400', '本塁打': '', '対右': {'打率': '.450', '本塁打': ''}}, 'saburo': {'打率': '', '本塁打': '', '対右': {'打率': '', '本塁打': ''}}}
```

---

### おわり

参照渡しなので、returnしたりしなくても適宜dictを更新していけるのは楽。

ただし、初期dictを複数の場所で使うような場合は注意が必要になる。

---

{{< ad/con/wide/python_taikutsu >}}

---

{{< ad/a8/techacademy_python >}}

---
